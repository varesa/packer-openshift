{
  "variables": {
    "vsphere_password": "vsphere-password",
    "guest_password": "guest-password"
  },

  "builders": [
    {
      "type": "vsphere-clone",

      "vcenter_server": "vcenter.tre.esav.fi",
      "username": "vsphere_packer",
      "password": "{{user `vsphere_password`}}",
      "insecure_connection": true,
      "datacenter": "Tampere",

      "template": "Z_Templates/centos7clean",
      "vm_name": "centos7packed",
      "folder": "Z_Templates",
      "host": "vsan",
      "datastore": "vsanDatastore",
      "linked_clone": false,

      "CPUs": 2,
      "CPU_reservation": 1000,
      "CPU_limit": 2000,
      "RAM": 2048,
      "RAM_reservation": 2048,

      "ssh_username": "root",
      "ssh_password": "{{user `guest_password`}}",

      "shutdown_command": "shutdown -P now",
      "shutdown_timeout": "5m",
      "create_snapshot": true,
      "convert_to_template": false
    }
  ],

  "provisioners": [
    {
      "type": "shell",
      "environment_vars": [],
      "inline": [
        "yum update -y",
        "yum install -y https://yum.puppetlabs.com/puppet5/puppet5-release-el-7.noarch.rpm",
        "yum install -y https://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-1.el7.centos.noarch.rpm",
        "yum install -y epel-release firewalld git htop ipa-client puppet-agent tcpdump tmux vim-enhanced wget zabbix-agent zsh",
        "echo built `date` >> /root/built"
      ]
    }
  ]
}

