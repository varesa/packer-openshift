{
  "variables": {
    "vsphere_address": "vsphere address",
    "vsphere_username": "vsphere username",
    "vsphere_password": "vsphere password"
  },

  "builders": [
    {
      "type": "vsphere-clone",

      "vcenter_server": "{{user `vsphere_address`}}",
      "username": "{{user `vsphere_username`}}",
      "password": "{{user `vsphere_password`}}",
      "insecure_connection": true,

      "datacenter": "Tampere",
      "cluster": "vsan",
      "datastore": "vsanDatastore",

      "template": "centos7-base",

      "vm_name": "centos7-puppet",
      "folder": "Z_Templates",

      "ssh_username": "root",
      "ssh_password": "password",

      "shutdown_command": "cloud-init clean --reboot",
      "shutdown_timeout": "5m",

      "convert_to_template": true
     }
   ],

   "provisioners": [
     {
        "type": "file",
        "source": "provision/cloud.cfg",
        "destination": "/etc/cloud/cloud.cfg"
     },
     {
       "type": "shell",
       "environment_vars": [],
       "inline": [
         "yum update -y",
         "yum install -y cloud-init",
         "yum install -y https://github.com/akutz/cloud-init-vmware-guestinfo/releases/download/v1.1.0/cloud-init-vmware-guestinfo-1.1.0-1.el7.noarch.rpm",
         "yum clean all",
         "systemctl enable cloud-init",
         "rm /etc/ssh/ssh_host*",
       ]
     }
   ]
}
